{% load static tailwind_tags %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <title>Detail Repository</title>
  {% tailwind_css %}
  <style>
    #loadingSpinner {
        z-index: 10;
    }
    .spinner {
        border: 4px solid rgba(255, 9, 9, 0.587);
        border-radius: 50%;
        border-top: 4px solid #fff;
        width: 50px;
        height: 50px;
        -webkit-animation: spin 1s linear infinite; /* Safari */
        animation: spin 1s linear infinite;
        position: fixed;
    }

    /* Safari */
    @-webkit-keyframes spin {
        0% { -webkit-transform: rotate(0deg); }
        100% { -webkit-transform: rotate(360deg); }
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>
</head>

<body>
  <!-- Navbar Start -->
  {% block section %}
  {% include "component/navbar_logged.html" %}
  {% endblock %}
  <!-- Navbar End -->
  <div id="loadingSpinner" class="fixed inset-0 bg-gray-700 bg-opacity-50 flex justify-center items-center hidden ">
    <div class="spinner"></div>
  </div>
  <!-- Content Start -->
  <div class="absolute">
    <div class=" mt-24 mx-32">
      <div class=" text-gray-500 font-semibold text-sm">
        <button class="flex items-center back-button">
          <svg
            width="15"
            height="16"
            viewBox="0 0 15 16"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M6.60901 0.543593L0.356415 6.78845C0.242567 6.90723 0.153324 7.04729 0.0938059 7.20061C-0.0312686 7.50468 -0.0312686 7.84575 0.0938059 8.14982C0.153324 8.30314 0.242567 8.4432 0.356415 8.56198L6.60901 14.8068C6.72561 14.9233 6.86403 15.0157 7.01637 15.0787C7.16871 15.1417 7.33199 15.1741 7.49688 15.1741C7.8299 15.1741 8.14927 15.042 8.38475 14.8068C8.62023 14.5717 8.75252 14.2527 8.75252 13.9201C8.75252 13.5875 8.62023 13.2685 8.38475 13.0333L4.25804 8.92418H13.7495C14.0811 8.92418 14.3992 8.7926 14.6337 8.55837C14.8682 8.32414 15 8.00646 15 7.67521C15 7.34397 14.8682 7.02629 14.6337 6.79206C14.3992 6.55783 14.0811 6.42624 13.7495 6.42624L4.25804 6.42624L8.38475 2.31713C8.50196 2.20102 8.59499 2.06289 8.65848 1.91069C8.72197 1.75849 8.75465 1.59524 8.75465 1.43036C8.75465 1.26548 8.72197 1.10223 8.65848 0.950037C8.59499 0.797838 8.50196 0.659702 8.38475 0.543593C8.2685 0.42653 8.13019 0.333611 7.9778 0.270203C7.82542 0.206794 7.66197 0.17415 7.49688 0.17415C7.3318 0.17415 7.16835 0.206794 7.01596 0.270203C6.86357 0.333611 6.72527 0.42653 6.60901 0.543593Z"
              fill="#A3A3A3"
            />
          </svg>
          <div
            class="text-neutral-400 text-base font-medium p-2"
            >
            back
          </div>
        </button>
        <div class="text-gray-700 font-bold text-xl mt-4">
          {{ details.Repository_Name }}
        </div>
        <div class="text-black font-normal text-sm mt-2">
          Owned by: {{ details.Owner_Name }}
        </div>
        <div class="bg-gray-300 h-px my-7 w-full"></div>
      </div>
    </div>
  
  
  <div class="flex flex-row">
     <!-- Sidebar Start -->
    <div class="sidebar mr-6">
      <div class="flex flex-col ml-32">
        <div class="font-semibold text-xl mb-5 ">
          About
        </div>
        <div class="text-gray-500 text-sm">
          {{ details.About }}
        </div>
        <hr class="mt-5">
        <div class="font-semibold text-xl mb-5 mt-4">
          <ul>
            {% for lang, percentage in details.Languages.items %}
                <li>{{ lang }}: {{ percentage }}</li>
            {% endfor %}
          </ul>
        </div>
        <hr class="mt-5">
        <div class="font-semibold text-xl  mt-4">
          File Size
        </div>
        <div class="font-normal ">
          {{ details.File_Size }} KB
        </div>
        <hr class="mt-5"> 
        <div class="font-semibold text-xl  mt-4">
          Date Created
        </div>
        <div class="font-normal ">
          {{ details.Date_Created }}
        </div>
        <hr class="mt-5"> 
        <div class="font-semibold text-xl  mt-4">
          Topics
        </div>
        <div class="font-normal ">
          {% for topic in details.Topics %}{{ topic }} {% endfor %}
        </div>
        <hr class="mt-5"> 
        <div class="font-semibold text-xl  mt-4">
          Branch
        </div>
        <div class="font-normal ">
          {{ details.Branch }}
        </div>
        <hr class="mt-5"> 
        <div class="font-semibold text-xl  mt-4">
          Contributors
        </div>
        <div class="font-normal ">
          {% for contributor in details.Contributors %}{{ contributor }} {% endfor %}
        </div>
        <hr class="mt-5"> 
        <div class="font-semibold text-xl  mt-4">
          Stars
        </div>
        <div class="font-normal ">
          {{ details.Stars }}
        </div>
        <hr class="mt-5"> 
      </div>
    </div>
    <!-- Sidebar End -->
    
    <div class="content w-full mr-32 ">
      <a  href="{% url 'developer_statistic' repository_id %}" class="flex flex-row justify-end mb-6">
        <div class="bg-black text-white rounded items-center  px-5 font-semibold py-2">
          Developers Activity
        </div>
      </a>
     <!-- Graph Start -->
    <div class="border-gray-400 border-2 rounded-xl p-6">
      <div class="flex flex-row justify-between mb-11">
        <div class="flex flex-col">
          <div class="drop2" id="commitDropdown">
            <button class=" flex flex-row  px-5 py-1 border-gray-400 border-2 rounded-xl w-fit">
              <div class="font-bold text-sm mt-1" id="selectedChartType">
                Commit
              </div>
              <svg xmlns="http://www.w3.org/2000/svg" width="31" height="31" viewBox="0 0 31 31" fill="none">
                <path d="M7.56119 11.6105L15.1224 19.3508L22.6836 11.6105" stroke="#363062" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <div  class="menu2 absolute hidden bg-white rounded-lg shadow w-36 border-2 border-gray-500 mt-1 " id="commitDropdownMenu">
              <div  class="block px-4 py-3 text-md font-medium hover:bg-gray-700  dark:hover:bg-gray-600 dark:hover:text-white" onclick="changeChartType('commit')"> Commit</div>
              <div class="block px-4 py-3 text-md font-medium hover:bg-gray-700  dark:hover:bg-gray-600 dark:hover:text-white" onclick="changeChartType('pullRequest')"> Pull Request</div>
            </div>
          </div>
        </div>
          <div class="kosong">
          
          </div>
          <div class="drop relative">
            <button class=" flex flex-row  px-5 py-1 border-gray-400 border-2 rounded-full">
              <div id="selectedYear" class="font-bold text-sm mt-1">
                Monthly (2023)
              </div>
              <svg xmlns="http://www.w3.org/2000/svg" width="31" height="31" viewBox="0 0 31 31" fill="none">
                <path d="M7.56119 11.6105L15.1224 19.3508L22.6836 11.6105" stroke="#363062" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <div  class="menu absolute hidden bg-white rounded-lg shadow w-36 border-2 border-gray-500 mt-1 " id="dropdownMenu">
              <div   onclick="changeYear(2017)"class="block px-4 py-3 text-md font-medium hover:bg-gray-700  dark:hover:bg-gray-600 dark:hover:text-white"> 2017</div>
              <div   onclick="changeYear(2018)" class="block px-4 py-3 text-md font-medium hover:bg-gray-700  dark:hover:bg-gray-600 dark:hover:text-white"> 2018</div>
              <div   onclick="changeYear(2019)" class="block px-4 py-3 text-md font-medium hover:bg-gray-700  dark:hover:bg-gray-600 dark:hover:text-white"> 2019</div>
              <div   onclick="changeYear(2020)" class="block px-4 py-3 text-md font-medium hover:bg-gray-700  dark:hover:bg-gray-600 dark:hover:text-white"> 2020</div>
              <div   onclick="changeYear(2021)" class="block px-4 py-3 text-md font-medium hover:bg-gray-700  dark:hover:bg-gray-600 dark:hover:text-white"> 2021</div>
              <div   onclick="changeYear(2023)" class="block px-4 py-3 text-md font-medium hover:bg-gray-700  dark:hover:bg-gray-600 dark:hover:text-white"> 2023</div>
            </div>
          </div>
          </div>
          <div class="flex flex-row justify-between mb-10">
              <div class="text-base font-bold">
                Last Week <span class="text-green-500">10</span>
              </div>
            <div class="kosong">

            </div>
            <div class="flex flex-row">
              <div class="text-base font-bold flex flex-row">
                10 <span class="text-green-500">1%</span> 
                <svg xmlns="http://www.w3.org/2000/svg" width="31" height="32" viewBox="0 0 31 32" fill="none">
                  <rect x="-0.5" y="-0.5" width="29.9612" height="29.2448" transform="matrix(-4.27e-08 -1 -1 4.47468e-08 30.0015 30.7673)" stroke="#A3A3A3"/>
                  <path d="M8.31802 20.1569L15.8792 12.4166L23.4404 20.1569" fill="#37D159"/>
                </svg>
              </div>
            </div>
          </div>
          
        <canvas id="myChart"> </canvas>
    </div>
      <!-- Graph End  -->
        </div>
      </div>
  <!-- Content End -->
</div>



  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const dropdownButton = document.querySelector(".group");
      const dropdownMenu = document.querySelector(".absolute");
      dropdownButton.addEventListener("click", function () {
        dropdownMenu.classList.toggle("hidden");
      });
    });

    document.addEventListener('DOMContentLoaded', function() {
            const compareButton = document.querySelector('a[href*="developer_statistic"]');
            const loadingSpinner = document.getElementById('loadingSpinner');

            compareButton.addEventListener('click', function() {
                loadingSpinner.classList.remove('hidden');
            });
        });

    document.addEventListener('DOMContentLoaded', function() {
        const backButton = document.querySelector('.back-button');
        backButton.addEventListener('click', function() {
            window.history.back();
        });
    });

    document.addEventListener("DOMContentLoaded", function () {
      const dropdownButton = document.querySelector(".drop");
      const dropdownMenu = document.querySelector(".menu");
      updateChart(2023);
      dropdownButton.addEventListener("click", function () {
        dropdownMenu.classList.toggle("hidden");
        if (!dropdownButton.contains(event.target) && !dropdownMenu.contains(event.target)) {
          dropdownMenu.classList.add('hidden');
    }
      });
    });
    document.addEventListener("DOMContentLoaded", function () {
    const commitDropdownButton = document.querySelector(".drop2");
    const commitDropdownMenu = document.querySelector(".menu2");

     commitDropdownButton.addEventListener("click", function () {
        commitDropdownMenu.classList.toggle("hidden");
       });
    });

function changeChartType(chartType) {
  const chartTypeLabel = chartType === 'commit' ? 'Commit' : 'Pull Request';
  document.getElementById('selectedChartType').textContent = chartTypeLabel;
  document.getElementById('selectedYear').textContent = `Monthly (2023)`;

  if (chartType === 'commit') {
    updateChart(2023);
  } else if (chartType === 'pullRequest') {
    ChartPullReq(2023);
  }
}


    function changeYear(year) {
    document.getElementById('selectedYear').textContent = `Monthly (${year})`;
    document.getElementById('dropdownMenu').classList.add('hidden');
    
    
    updateChart(year);
  }
  function updateChart(selectedYear) {
    const ctx = document.getElementById("myChart").getContext("2d");
    const existingChart = Chart.getChart(ctx);
    if (existingChart) {
      existingChart.destroy();
    }
    const commitData = JSON.parse('{{ details.CountCommit|safe }}');
    const datasets = [];

    var labels = [
      { label: "Jan", value: `${selectedYear}-01` },
      { label: "Feb", value: `${selectedYear}-02` },
      { label: "Mar", value: `${selectedYear}-03` },
      { label: "Apr", value: `${selectedYear}-04` },
      { label: "May", value: `${selectedYear}-05` },
      { label: "Jun", value: `${selectedYear}-06` },
      { label: "Jul", value: `${selectedYear}-07` },
      { label: "Aug", value: `${selectedYear}-08` },
      { label: "Sep", value: `${selectedYear}-09` },
      { label: "Oct", value: `${selectedYear}-10` },
      { label: "Nov", value: `${selectedYear}-11` },
      { label: "Dec", value: `${selectedYear}-12` }
    ];

    datasets.push({
        label: 'Total Commits',
        backgroundColor: "black",
        borderColor: "rgba(0,0,0, 1)",
        data: labels.map(entry => commitData[entry.value]?.total || 0),
        borderWidth: 2,
        barThickness: 20,
        barPercentage: 0.9,
        categoryPercentage: 1.0,
    });

    
    const contributors = Object.values(commitData)[0].contributors; 
    for (const contributor in contributors) {
        datasets.push({
            label: contributor,
            backgroundColor: getRandomColor(),
            data: labels.map(entry => commitData[entry.value]?.contributors[contributor] || 0),
            borderWidth: 2,
            barThickness: 20,
            barPercentage: 0.9,
            categoryPercentage: 1.0,
        });
    }
    new Chart(ctx, {
      type: "bar",
      data: {
        labels: labels.map(entry => entry.label),
        datasets: datasets
      },
      options: {
        scales: {
          y: {
            beginAtZero: true,
            stacked: false,
          },
          x: {
            stacked: true,
          },
        },
        plugins: {
          legend: {
            display: false,
          }
        },
        responsive: true
      }
    });
}

  function getRandomColor() {
    const letters = '0123456789ABCDEF';
    let color = '#';
    for (let i = 0; i < 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
    }
    return color;
}

function ChartPullReq(selectedYear){
  const ctx = document.getElementById("myChart").getContext("2d");
    const existingChart = Chart.getChart(ctx);
    if (existingChart) {
      existingChart.destroy();
    }
    const pullreqData = JSON.parse('{{ details.CountPullreq|safe }}');
    const datasets = [];
    var labels = [
      { label: "Jan", value: `${selectedYear}-01` },
      { label: "Feb", value: `${selectedYear}-02` },
      { label: "Mar", value: `${selectedYear}-03` },
      { label: "Apr", value: `${selectedYear}-04` },
      { label: "May", value: `${selectedYear}-05` },
      { label: "Jun", value: `${selectedYear}-06` },
      { label: "Jul", value: `${selectedYear}-07` },
      { label: "Aug", value: `${selectedYear}-08` },
      { label: "Sep", value: `${selectedYear}-09` },
      { label: "Oct", value: `${selectedYear}-10` },
      { label: "Nov", value: `${selectedYear}-11` },
      { label: "Dec", value: `${selectedYear}-12` }
    ];

    datasets.push({
        label: 'Total Commits',
        backgroundColor: "black",
        borderColor: "rgba(0,0,0, 1)",
        data: labels.map(entry => pullreqData[entry.value]?.total || 0),
        borderWidth: 2,
        barThickness: 20,
        barPercentage: 0.9,
        categoryPercentage: 1.0,
    });

    
    const contributors = Object.values(pullreqData)[0].contributors; 
    for (const contributor in contributors) {
        datasets.push({
            label: contributor,
            backgroundColor: getRandomColor(),
            data: labels.map(entry => pullreqData[entry.value]?.contributors[contributor] || 0),
            borderWidth: 2,
            barThickness: 20,
            barPercentage: 0.9,
            categoryPercentage: 1.0,
        });
    }
    new Chart(ctx, {
      type: "bar",
      data: {
        labels: labels.map(entry => entry.label),
        datasets: datasets
      },
      options: {
        scales: {
          y: {
            beginAtZero: true,
            stacked: false,
          },
          x: {
            stacked: true,
          },
        },
        plugins: {
          legend: {
            display: false,
          }
        },
        responsive: true
      }
    })
}
  </script>
</body>

</html>